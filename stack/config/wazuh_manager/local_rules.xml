<group name="local,sshd,authentication,">
  
  <rule id="100001" level="3">
    <if_sid>5716</if_sid>
    <regex>from (\S+) port</regex>
    <description>SSH authentication failure from $(srcip)</description>
    <mitre>
      <id>T1110.001</id>
    </mitre>
    <group>authentication_failed,</group>
  </rule>

  <rule id="100002" level="8" frequency="3" timeframe="60">
    <if_matched_sid>100001</if_matched_sid>
    <same_source_ip />
    <description>SSH brute force: $(frequency) failed attempts from $(srcip)</description>
    <mitre>
      <id>T1110.001</id>
    </mitre>
    <group>attacks,brute_force,</group>
  </rule>

  <rule id="100003" level="3">
    <if_sid>5715</if_sid>
    <regex>from (\S+) port</regex>
    <description>SSH successful login: $(user) from $(srcip)</description>
    <mitre>
      <id>T1078</id>
    </mitre>
    <group>authentication_success,</group>
  </rule>

  <rule id="100004" level="12" timeframe="300">
    <if_matched_sid>100002</if_matched_sid>
    <if_matched_sid>100003</if_matched_sid>
    <same_source_ip />
    <description>CRITICAL: SSH brute force success $(srcip) user $(user)</description>
    <mitre>
      <id>T1110.001</id>
      <id>T1078</id>
    </mitre>
    <group>attacks,brute_force_success,</group>
  </rule>

  <rule id="100005" level="15" timeframe="300">
    <if_matched_sid>100004</if_matched_sid>
    <list field="user" lookup="not_address_match_key">etc/lists/known_users</list>
    <description>CRITICAL: SSH brute force with UNKNOWN USER $(user) from $(srcip)</description>
    <mitre>
      <id>T1110.001</id>
      <id>T1078.003</id>
    </mitre>
    <group>attacks,unknown_user,</group>
  </rule>

</group>